<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>硬成本折减对话框</title>
</head>
<body>
	<th:block th:fragment="dialog">
		<div class="row clearfix">
			<div class="col-md-12 column">
				<!-- <a type="hidden" hidden="true" id="modal-273078" href="#modal-container-273078" role="button" class="btn" data-toggle="modal">触发遮罩窗体</a> -->
				<input id="modal-273079" type="hidden" class="btn btn-primary"
					value="硬成本折减" data-toggle="modal"
					data-target="#modal-container-273078" />
				<div class="modal fade" id="modal-container-273079" role="dialog"
					aria-labelledby="myModalLabel" aria-hidden="true">
					<div class="modal-dialog">
						<div class="modal-content">
							<div class="modal-header">
								<button type="button" class="close" data-dismiss="modal"
									aria-hidden="true">×</button>
								<h4 class="modal-title" id="discount-hard-cost-info">硬成本折减</h4>
							</div>
							<div class="modal-body">

								<!-- 硬成本折减金额 -->
								<form id="dialog-form" class="form-horizontal" role="">
									<div class="form-group">
										<label for="discount-hard-cost-price" class="col-sm-3 control-label">折减金额</label>
										<div class="col-sm-8">
											<input type="text" id="discount-hard-cost-price" name="discount-hard-cost-price"
												class="form-control" placeholder="折减金额" autofocus required>
										</div>
									</div>
									<div class="form-group">
										<label for="hard-cost-price" class="col-sm-3 control-label">原硬成本</label>
										<div class="col-sm-8">
											<span type="text" id="hard-cost-price" name="hard-cost-price"
												class="" placeholder="原硬成本" th:text="${contractItem.hardCostPrice}">
											</span>
										</div>
									</div>											
								</form>								
							</div>
							<span class="col-sm-8 col-sm-offset-1 control-label">
										注:在原有硬成本基础上折减.
							</span>
							<div class="modal-footer">
								<button id="btnClose" type="button" class="btn btn-primary"
									data-dismiss="modal" aria-hidden="true">关闭</button>
								<button id="btnDiscountConfirm" type="button" class="btn btn-primary">确定</button>
							</div>
						</div>
					</div>

				</div>

			</div>
	</th:block>
</body>

<script th:inline="javascript"> 
	/*<![CDATA[*/  
		var curr_contractItem = [[${contractItem}]];  //合同商品行项目
	/*]]>*/  
</script>  

<script type="text/javascript">
	
	//更新硬成本折减及最新硬成本
	function updateDiscountHardCostPrice(itemId,discount){
		var url = BASE_CONTEXT_PATH + "/back/contract/discountHardCostPrice"; // 需要提交的 url
	
		$.ajax({
			type : "post", // 提交方式 get/post
			url : url, // 需要提交的 url
			// dataType: "application/json",
			data : {
				'itemId' : itemId,
				'discount':discount
			},
			success : function(res) { // data 保存提交后返回的数据，一般为 json 数据
				console.log(res);
				if (res != null && res != "") {
					var obj = $.parseJSON(res);
					if (obj.result_code == "success") {
						util.message(obj.result_msg); //显示更新成功能对话框，此处省略
					} else {
						util.message(obj.result_err_msg);
					}
				}
			}
	
		});
	}

	$(function(){
		/**
		 * 折减对话框【确定】按钮-click处理
		 */
		$("#btnDiscountConfirm").on('click', function(e) {
			closeDiscountHardCostDialog();
			var discountStr = $("#discount-hard-cost-price").val();
			var discount = parseInt(discountStr, 10);
			if (isNaN(discount)) {
				util.message("所输入的不是数字！");
			} else {
				var itemId
				updateDiscountHardCostPrice(curr_contractItem.id,discount); //后台更新折减
			}

		});
	});

</script>


</html>